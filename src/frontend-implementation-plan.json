{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Competitive-exam typing practice website (Hindi + English) â€” Frontend",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Build a responsive exam-style typing practice screen with English/Hindi mode switch, passage area, input, timer, and live stats.",
      "acceptanceCriteria": [
        "User can switch between English and Hindi modes from the main screen without page reload.",
        "UI shows: a passage to type, a typing input area, a countdown timer, and live metrics (WPM, accuracy, errors).",
        "The layout is usable on desktop and mobile (no horizontal scrolling on typical viewport widths)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/App.tsx",
          "operation": "create",
          "description": "Create the main app shell and render the typing practice experience as the primary view (no extra routes), including a header/branding area and space for optional history. Wire in generated assets at frontend/public/assets/generated/typing-hero.dim_1600x600.png and frontend/public/assets/generated/lang-mark.dim_256x256.png. Use shadcn-ui components (e.g., Card, Button, Tabs/Toggle, Select) to compose the UI; do not edit frontend/src/components/ui. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/features/typing/TypingPractice.tsx",
          "operation": "create",
          "description": "Implement the responsive competitive-exam layout (passage panel, typing input panel, timer + live stats bar, controls). Include language toggle (English/Hindi) that updates state without reload. Use shadcn-ui components for consistent controls and layout composition. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/features/typing/components/PassageDisplay.tsx",
          "operation": "create",
          "description": "Create a passage renderer that visually highlights correct/incorrect/untyped characters while maintaining legibility for both English and Devanagari text. Use shadcn-ui primitives where appropriate (e.g., Card) for the container. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/features/typing/components/StatsBar.tsx",
          "operation": "create",
          "description": "Create a compact stats bar component to display countdown, WPM/CPM, accuracy, and errors live, styled consistently with the app theme. Use shadcn-ui components where appropriate. Verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Implement the typing-test engine: duration selection, start/pause/reset, per-character evaluation/highlighting, and results view at time end.",
      "acceptanceCriteria": [
        "User can select a test duration (minimum: 1, 3, 5, 10 minutes) and start the test.",
        "During a test, the app highlights correct vs incorrect characters relative to the passage.",
        "When time reaches 0, input is disabled and a results summary is shown (WPM, gross WPM or CPM, accuracy %, total mistakes).",
        "Reset returns to a ready state with a new passage (or the option to retry the same passage)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/features/typing/useTypingEngine.ts",
          "operation": "create",
          "description": "Create a reusable hook to manage the test lifecycle (ready/running/paused/finished), countdown timing for 1/3/5/10 minutes, typed text state, derived metrics (WPM/CPM, accuracy, mistakes), and disable input at completion. Ensure the API supports reset and retry-same-passage behaviors."
        },
        {
          "path": "frontend/src/features/typing/components/DurationSelector.tsx",
          "operation": "create",
          "description": "Implement a duration selector (1, 3, 5, 10 minutes) using shadcn-ui controls (e.g., Select/ToggleGroup) to feed the typing engine. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/features/typing/components/ResultsSummary.tsx",
          "operation": "create",
          "description": "Create a results summary UI shown when time ends, displaying WPM/CPM, accuracy, total mistakes, language, and duration, plus actions for retry and new passage. Use shadcn-ui components (e.g., Dialog/AlertDialog, Card, Button) for presentation. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/features/typing/TypingPractice.tsx",
          "operation": "modify",
          "description": "Wire the typing engine hook into the typing UI: start/pause/reset actions, duration selection, live highlighting via PassageDisplay, input disabling at completion, and results summary presentation. Use shadcn-ui components for consistent controls. Verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Support Hindi (Devanagari) typing with Unicode-safe comparison and clear on-screen guidance for IME usage.",
      "acceptanceCriteria": [
        "In Hindi mode, the displayed passage uses Devanagari script and the typed input is evaluated correctly against it (no broken indexing due to Unicode).",
        "The UI includes a short English help note explaining that Hindi input requires a Devanagari keyboard/IME (no third-party auth/integration).",
        "Mistake counting and highlighting behave correctly for Hindi text (character-level comparison works for typical Devanagari characters and common punctuation)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/features/typing/unicode.ts",
          "operation": "create",
          "description": "Add Unicode-safe helpers for segmenting strings into compareable units (prefer grapheme segmentation via Intl.Segmenter when available, with a safe fallback) and for producing per-segment correctness arrays used by highlighting and mistake counting."
        },
        {
          "path": "frontend/src/features/typing/useTypingEngine.ts",
          "operation": "modify",
          "description": "Update comparison, indexing, mistake counting, and metrics derivation to use Unicode-safe segmentation utilities so Hindi (Devanagari) input evaluation does not break on multi-code-unit characters."
        },
        {
          "path": "frontend/src/features/typing/TypingPractice.tsx",
          "operation": "modify",
          "description": "Add an English-only help note visible in Hindi mode explaining that users should enable a Devanagari keyboard/IME to type Hindi. Ensure copy remains English per constraints."
        },
        {
          "path": "frontend/src/features/typing/components/PassageDisplay.tsx",
          "operation": "modify",
          "description": "Render highlighting based on Unicode-safe segmentation results so Devanagari characters and punctuation highlight correctly without visual misalignment."
        }
      ]
    },
    {
      "id": "REQ-4",
      "summary": "Fetch/select passages by language from the backend-backed passage library (random by language at minimum).",
      "acceptanceCriteria": [
        "There is a non-empty set of English passages and a non-empty set of Hindi passages available in the app.",
        "User can start a test in either language and always receives a passage in that language.",
        "Passage retrieval is implemented via backend canister query/update methods (not hardcoded only in the UI)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/services/passages.ts",
          "operation": "create",
          "description": "Create a small client wrapper that uses the existing core-infrastructure backend connection configuration to call the backend capability getPassagesByLanguage(language) from frontend/src/backend.d.ts and return passages for the selected language (frontend chooses randomly from the returned set)."
        },
        {
          "path": "frontend/src/features/typing/usePassage.ts",
          "operation": "create",
          "description": "Implement a React Query-powered passage loader hook keyed by language that fetches passages via services/passages.ts, selects a random passage, supports refetch for 'new passage', and exposes loading/error states. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/features/typing/TypingPractice.tsx",
          "operation": "modify",
          "description": "Integrate passage fetching/selection: on language change and on reset/new-passage, obtain a passage in the current language via the backend-backed retrieval hook, and ensure the typing engine resets appropriately."
        }
      ]
    },
    {
      "id": "REQ-6",
      "summary": "Apply a coherent exam-friendly theme/design system with a non-blue/non-purple primary accent.",
      "acceptanceCriteria": [
        "App has a consistent theme (e.g., neutral + accent) applied across header, buttons, cards, and typography.",
        "Primary color palette does not use blue/purple as the main accent.",
        "Key UI components (language selector, duration selector, start/reset buttons, stats) share consistent styling and spacing."
      ],
      "file_operations": [
        {
          "path": "frontend/src/index.css",
          "operation": "create",
          "description": "Define global theme tokens/CSS variables used by Tailwind/shadcn-ui (background/foreground/primary/accent, etc.) with a neutral base and a non-blue/non-purple accent (e.g., warm amber/green). Ensure typography and spacing feel exam/practice oriented."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Apply the theme consistently across the app shell (header, containers, spacing) and incorporate the generated branding assets for a cohesive visual identity. Use shadcn-ui components for consistent styling. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/features/typing/TypingPractice.tsx",
          "operation": "modify",
          "description": "Align all primary controls (language selector, duration selector, start/pause/reset buttons, stats presentation) with the design system using composed shadcn-ui components and consistent spacing. Verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-7",
      "summary": "Add an optional results/history section using React Query for caching and graceful loading/error states.",
      "acceptanceCriteria": [
        "After completing a test, the latest result is visible in a history list (either locally or fetched from backend if implemented).",
        "History list shows at least: language, duration, WPM, accuracy, and timestamp/relative time.",
        "Data fetching uses React Query with loading/error states handled gracefully."
      ],
      "file_operations": [
        {
          "path": "frontend/src/features/history/historyStore.ts",
          "operation": "create",
          "description": "Implement a lightweight local history persistence utility (e.g., localStorage) with functions to read/write a bounded list of recent attempts; designed to be used as a React Query data source."
        },
        {
          "path": "frontend/src/features/history/useHistory.ts",
          "operation": "create",
          "description": "Create React Query hooks for history: a query that loads recent attempts from historyStore with loading/error handling, and helpers to optimistically insert the latest result after test completion (using React Query cache updates). Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/features/history/HistoryPanel.tsx",
          "operation": "create",
          "description": "Create an optional UI panel that lists recent attempts (language, duration, WPM, accuracy, timestamp/relative time) with loading/empty/error states. Use shadcn-ui components (e.g., Card, Table, Skeleton/Alert) for consistent presentation. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/services/sessions.ts",
          "operation": "create",
          "description": "Add a small client wrapper that uses the existing core-infrastructure backend connection configuration to call the backend capability recordSession(session) for anonymous result recording (no login), and returns success/failure for UI handling."
        },
        {
          "path": "frontend/src/features/typing/TypingPractice.tsx",
          "operation": "modify",
          "description": "On test completion, write the result into local history (via useHistory) and attempt to record it via services/sessions.ts; keep UI usable if recording fails. Render HistoryPanel below or alongside the main practice UI as an optional section."
        }
      ]
    }
  ]
}